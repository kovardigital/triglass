<!--
  LIFTOFF - Body Embed (Minimal)
  Add this to Webflow: Project Settings > Custom Code > Footer Code
  (This goes before </body>)

  Pure CSS 3D transforms - no external libraries needed.
  Scroll to see content fly towards you in Z-space.
-->

<script>
(function() {
  'use strict';

  console.log('%c[LIFTOFF] Body script starting...', 'color: #6b7cff; font-weight: bold');

  // Configuration
  const SECTION_DEPTH = 1000;
  const TOTAL_SECTIONS = 5;
  const STAR_COUNT = 600;

  // ========== STARFIELD ==========
  class Starfield {
    constructor(container) {
      this.container = container;
      this.canvas = document.createElement('canvas');
      this.ctx = this.canvas.getContext('2d');
      this.stars = [];
      this.scrollProgress = 0;
      this.container.appendChild(this.canvas);
      this.resize();
      this.createStars();
      this.animate();
      window.addEventListener('resize', () => this.resize());
    }
    resize() {
      this.width = window.innerWidth;
      this.height = window.innerHeight;
      this.canvas.width = this.width;
      this.canvas.height = this.height;
      this.centerX = this.width / 2;
      this.centerY = this.height / 2;
    }
    createStars() {
      this.stars = [];
      for (let i = 0; i < STAR_COUNT; i++) {
        const star = {
          x: Math.random() * this.width,
          y: Math.random() * this.height,
          size: 0.5 + Math.random() * 1.5,
          brightness: 0.3 + Math.random() * 0.7,
          twinkleOffset: Math.random() * Math.PI * 2,
          twinkleSpeed: 0.003 + Math.random() * 0.006,
          twinkleAmount: 0.3 + Math.random() * 0.7,
          layer: Math.floor(Math.random() * 3),
        };
        star.baseX = star.x;
        star.baseY = star.y;
        this.stars.push(star);
      }
    }
    setScrollProgress(progress) { this.scrollProgress = progress; }
    animate() {
      this.ctx.clearRect(0, 0, this.width, this.height);
      const time = Date.now();
      const zoomFactor = 1 + this.scrollProgress * 0.3;
      this.stars.forEach(star => {
        const twinkle = Math.sin(time * star.twinkleSpeed + star.twinkleOffset);
        const twinkleValue = 0.5 + twinkle * 0.5;
        const opacity = star.brightness * (1 - star.twinkleAmount + star.twinkleAmount * twinkleValue);
        const layerZoom = zoomFactor * (1 + star.layer * 0.15);
        const dx = star.baseX - this.centerX;
        const dy = star.baseY - this.centerY;
        const x = this.centerX + dx * layerZoom;
        const y = this.centerY + dy * layerZoom;
        this.ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
        this.ctx.fillRect(Math.floor(x), Math.floor(y), Math.ceil(star.size), Math.ceil(star.size));
      });
      requestAnimationFrame(() => this.animate());
    }
  }

  // Create starfield
  const starfieldContainer = document.createElement('div');
  starfieldContainer.className = 'starfield';
  document.body.appendChild(starfieldContainer);
  const starfield = new Starfield(starfieldContainer);

  // ========== ASTEROIDS ==========
  const asteroidsContainer = document.createElement('div');
  asteroidsContainer.className = 'asteroids';
  document.body.appendChild(asteroidsContainer);

  const asteroidConfigs = [
    { x: -5, y: 10, size: 200, depth: 0.3, rotation: 0 },
    { x: 85, y: 15, size: 150, depth: 0.5, rotation: 45 },
    { x: -8, y: 45, size: 120, depth: 0.7, rotation: 90 },
    { x: 90, y: 55, size: 250, depth: 0.2, rotation: 180 },
    { x: 5, y: 75, size: 100, depth: 0.6, rotation: 270 },
    { x: 80, y: 80, size: 180, depth: 0.4, rotation: 135 },
  ];

  const asteroids = [];
  asteroidConfigs.forEach((config) => {
    const asteroid = document.createElement('div');
    asteroid.className = 'asteroid';
    asteroid.style.left = `${config.x}%`;
    asteroid.style.top = `${config.y}%`;
    asteroid.style.width = `${config.size}px`;
    asteroid.style.height = `${config.size}px`;
    asteroid.innerHTML = `<svg viewBox="0 0 100 100" fill="none"><path d="M50 5 C70 8, 90 25, 95 50 C92 75, 75 92, 50 95 C25 92, 8 75, 5 50 C8 25, 25 8, 50 5 Z" fill="#1a1a2e" stroke="#2a2a4a" stroke-width="1"/><ellipse cx="35" cy="40" rx="12" ry="8" fill="#0f0f1a" opacity="0.5"/><ellipse cx="65" cy="60" rx="10" ry="6" fill="#0f0f1a" opacity="0.4"/></svg>`;
    asteroid.dataset.depth = config.depth;
    asteroid.dataset.rotation = config.rotation;
    asteroidsContainer.appendChild(asteroid);
    asteroids.push(asteroid);
  });

  let mouseX = 0, mouseY = 0, targetMouseX = 0, targetMouseY = 0;
  document.addEventListener('mousemove', (e) => {
    targetMouseX = (e.clientX / window.innerWidth - 0.5) * 2;
    targetMouseY = (e.clientY / window.innerHeight - 0.5) * 2;
  });

  let scrollProgress = 0;

  // Scene animation with parallax effect
  function animateScene() {
    // Smooth mouse movement
    mouseX += (targetMouseX - mouseX) * 0.05;
    mouseY += (targetMouseY - mouseY) * 0.05;

    // Steering rotation based on horizontal mouse position (like turning a spaceship)
    const steerAngle = mouseX * 12; // degrees of rotation - more dramatic

    // Parallax: shift opposite to mouse direction + steering rotation
    // Starfield moves least (furthest away) - subtle shift + rotation
    const starfieldOffsetX = -mouseX * 30;
    const starfieldOffsetY = -mouseY * 30;
    starfieldContainer.style.transform = `translate(${starfieldOffsetX}px, ${starfieldOffsetY}px) rotate(${steerAngle * 0.3}deg)`;

    // Asteroids container - medium depth, more pronounced
    const asteroidsOffsetX = -mouseX * 80;
    const asteroidsOffsetY = -mouseY * 80;
    asteroidsContainer.style.transform = `translate(${asteroidsOffsetX}px, ${asteroidsOffsetY}px) rotate(${steerAngle * 0.7}deg)`;

    // Text viewport - closest to camera, most rotation
    const viewportOffsetX = -mouseX * 50;
    const viewportOffsetY = -mouseY * 50;
    if (window.liftoffViewport) {
      window.liftoffViewport.style.transform = `translate(${viewportOffsetX}px, ${viewportOffsetY}px) rotate(${steerAngle}deg)`;
    }

    // Individual asteroids: parallax + rotation + scale
    asteroids.forEach(asteroid => {
      const depth = parseFloat(asteroid.dataset.depth);
      const baseRotation = parseFloat(asteroid.dataset.rotation);
      const asteroidOffsetX = -mouseX * depth * 150;
      const asteroidOffsetY = -mouseY * depth * 150;
      const scale = 1 + scrollProgress * depth * 0.3;
      const rotation = baseRotation + Date.now() * 0.002 * depth;
      asteroid.style.transform = `translate(${asteroidOffsetX}px, ${asteroidOffsetY}px) scale(${scale}) rotate(${rotation}deg)`;
    });

    requestAnimationFrame(animateScene);
  }
  animateScene();

  // Create the 3D viewport (fixed, with perspective)
  const viewport = document.createElement('div');
  viewport.className = 'liftoff-viewport';
  window.liftoffViewport = viewport;

  // Create the 3D world (moves on scroll)
  const world = document.createElement('div');
  world.className = 'liftoff-world';
  viewport.appendChild(world);

  // Create sections at different Z depths
  const sectionData = [
    { title: 'LIFTOFF', subtitle: 'A journey beyond the stars' },
    { title: 'THE MISSION', subtitle: 'Humanity\'s greatest adventure' },
    { title: 'THE CREW', subtitle: 'Five astronauts. One chance.' },
    { title: 'THE STAKES', subtitle: 'Everything we know hangs in the balance' },
    { title: 'COMING SOON', subtitle: '2026' }
  ];

  const sections = [];
  sectionData.forEach((data, index) => {
    const section = document.createElement('div');
    section.className = 'liftoff-section';
    section.innerHTML = `
      <h1>${data.title}</h1>
      <p>${data.subtitle}</p>
    `;
    // Position each section further back in Z-space
    // Negative Z = further away from camera
    const zPos = -index * SECTION_DEPTH;
    section.style.transform = `translate(-50%, -50%) translateZ(${zPos}px)`;
    section.dataset.zPos = zPos;
    world.appendChild(section);
    sections.push(section);

    console.log(`[LIFTOFF] Section ${index}: "${data.title}" at Z=${zPos}`);
  });

  // Create scroll spacer (makes the page scrollable)
  const scrollSpacer = document.createElement('div');
  scrollSpacer.className = 'liftoff-scroll-spacer';

  // Create debug display
  const debug = document.createElement('div');
  debug.className = 'liftoff-debug';
  debug.innerHTML = 'Scroll: 0% | Z: 0';

  // Add elements to page
  document.body.appendChild(viewport);
  document.body.appendChild(scrollSpacer);
  document.body.appendChild(debug);

  console.log('%c[LIFTOFF] DOM elements created', 'color: #10b981');

  // Calculate total Z travel distance
  const totalDepth = (TOTAL_SECTIONS - 1) * SECTION_DEPTH;

  // Scroll handler - moves the world forward in Z
  function onScroll() {
    const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollTop = window.scrollY;
    const progress = scrollHeight > 0 ? scrollTop / scrollHeight : 0;

    // Move world forward (positive Z) based on scroll
    // This brings the sections towards the camera
    const worldZ = progress * totalDepth;

    world.style.transform = `translate(-50%, -50%) translateZ(${worldZ}px)`;

    // Update starfield zoom
    starfield.setScrollProgress(progress);
    scrollProgress = progress;

    // Update opacity for each section based on effective Z position
    sections.forEach((section) => {
      const sectionZ = parseFloat(section.dataset.zPos);
      const effectiveZ = sectionZ + worldZ;

      let opacity = 0;
      if (effectiveZ < -800) {
        opacity = 0;
      } else if (effectiveZ < -100) {
        opacity = (effectiveZ + 800) / 700;
      } else if (effectiveZ <= 300) {
        opacity = 1;
      } else {
        opacity = Math.max(0.3, 1 - (effectiveZ - 300) / 500);
      }

      section.style.opacity = Math.max(0, Math.min(1, opacity));
    });

    // Update debug
    debug.innerHTML = `Scroll: ${Math.round(progress * 100)}% | World Z: ${Math.round(worldZ)}px`;
  }

  // Listen for scroll
  window.addEventListener('scroll', onScroll, { passive: true });

  // Initial call
  onScroll();

  console.log('%c[LIFTOFF] Scroll listener attached. Total Z depth: ' + totalDepth + 'px', 'color: #10b981');
  console.log('%c[LIFTOFF] Ready! Scroll to see 3D effect.', 'color: #6b7cff; font-weight: bold');

})();
</script>
